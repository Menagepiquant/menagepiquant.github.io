<!DOCTYPE html>
<html lang="fr-CA">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>M√©nage Piquant ‚Äî Cute VIP</title>
  <meta name="description" content="M√©nage Piquant, service de m√©nage sexy et mignon, sans contact. Books Woman et Male avec acc√®s VIP, prise de rendez-vous √©l√©gante et discr√®te." />
  <meta name="theme-color" content="#f6e8ff" />
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Poppins:wght@500;700&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --light:#fff8fe; --ink:#2a2a33; --muted:#6d6b79;
      --brand:#ff5fa2; --accent:#ffd86b; --line:#ece7f6;
      --card:#ffffff; --shadow:0 10px 30px rgba(170,140,255,.18);
      --r:22px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--light);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    img{display:block;max-width:100%;height:auto}
    a{color:var(--ink);text-decoration:none}
    .wrap{max-width:1200px;margin:0 auto;padding:20px}

    /* Header */
    header{position:sticky;top:0;z-index:40;background:rgba(255,255,255,.7);backdrop-filter:saturate(180%) blur(10px);border-bottom:1px solid var(--line)}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:16px}
    .brand{display:flex;align-items:center;gap:12px;font-weight:800;color:#3a3350}
    .logo{width:34px;height:34px;border-radius:12px;border:1px solid var(--line);background:conic-gradient(from 220deg, var(--brand), var(--accent), #b8ffd0, #e8d6ff, var(--brand));box-shadow:0 6px 18px rgba(255,95,162,.25)}
    .links{display:flex;gap:10px;flex-wrap:wrap}
    .badge{display:inline-flex;align-items:center;gap:6px;background:#ffffffbd;border:1px solid var(--line);border-radius:999px;padding:9px 14px;font-size:13px;color:#5a5766;box-shadow:0 4px 12px rgba(70,50,120,.06)}
    .btn{display:inline-block;padding:12px 18px;border-radius:999px;border:1px solid var(--line);background:linear-gradient(180deg,#ff86bc,#ff5fa2);color:#fff;font-weight:800;box-shadow:0 10px 26px rgba(255,95,162,.22);transition:transform .18s ease, box-shadow .18s ease}
    .btn:hover{transform:translateY(-2px);box-shadow:0 14px 30px rgba(255,95,162,.28)}
    .btn.ghost{background:#fff;border-color:var(--line);color:#3a3350;font-weight:700;box-shadow:0 8px 20px rgba(80,60,130,.08)}
    .btn.small{padding:10px 14px;font-size:14px}

    /* Hero, cards, type */
    .hero{display:grid;grid-template-columns:1.1fr .9fr;gap:28px;align-items:center;padding:40px 0}
    .hero h1{font-family:Poppins,Inter,sans-serif;font-size:clamp(30px,4.5vw,58px);line-height:1.04;margin:0 0 10px;color:#3a3350}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--r);padding:22px;box-shadow:var(--shadow)}
    h2{font-family:Poppins,Inter,sans-serif;font-size:clamp(22px,3vw,34px);margin:18px 0 10px;color:#3a3350}
    h3{font-weight:700;color:#473d63;margin:14px 0 8px}
    p{line-height:1.75;margin:8px 0}
    ul{margin:8px 0 0 18px;line-height:1.75;color:#6a627c}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    .chip{border:1px solid var(--line);background:#fff;color:#5a5766;padding:8px 12px;border-radius:999px;font-size:13px;box-shadow:0 6px 14px rgba(90,80,130,.06)}
    .cta{display:flex;gap:12px;flex-wrap:wrap;margin-top:18px}
    .note{font-size:13px;color:#7a7688}

    /* Tabs */
    .switcher{display:flex;gap:8px;flex-wrap:wrap}
    .pill{cursor:pointer;border:1px solid var(--line);background:#fff;color:#5a5766;padding:10px 14px;border-radius:999px;font-weight:700;transition:all .15s ease;box-shadow:0 8px 18px rgba(80,60,130,.06)}
    .pill.active{color:#3a3350;background:linear-gradient(180deg,#ffffff,#fff6fb);border-color:#f3e6ff;transform:translateY(-1px)}

    /* Galleries */
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px}
    .tile{position:relative;overflow:hidden;border-radius:20px;border:1px solid var(--line);background:#fff;box-shadow:0 12px 28px rgba(70,50,120,.08);transition:transform .2s ease}
    .tile:hover{transform:translateY(-2px)}
    .tile img{width:100%;height:100%;object-fit:cover;aspect-ratio:3/4;transition:transform .5s ease, filter .4s ease}
    .tile:hover img{transform:scale(1.04)}
    .cap{position:absolute;left:10px;bottom:10px;font-size:12px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.9);border:1px solid var(--line);color:#4a415f;font-weight:700;box-shadow:0 6px 14px rgba(70,50,120,.14)}
    .edit{position:absolute;right:10px;bottom:10px;display:inline-flex;align-items:center;gap:6px;padding:6px 8px;border-radius:10px;background:rgba(255,255,255,.92);border:1px solid var(--line);font-size:12px;color:#4a415f;font-weight:700;cursor:pointer}
    .edit:before{content:"‚úèÔ∏è";}

    /* Forms */
    input,textarea,select{width:100%;padding:12px 14px;border-radius:14px;border:1px solid var(--line);background:#fff;color:#38344a;outline:none;box-shadow:0 8px 20px rgba(80,60,130,.06)}
    label{font-size:13px;color:#6d6a7b;display:block;margin-bottom:6px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    .state.ok{background:#eefdf3;border-color:#dcfae6}
    .state.err{background:#fff0f3;border-color:#ffd6df}

    footer{border-top:1px solid var(--line);margin-top:36px}
    .center{text-align:center}

    /* Lightbox */
    .lightbox{position:fixed;inset:0;background:rgba(25,20,35,.7);display:none;align-items:center;justify-content:center;z-index:60;backdrop-filter:blur(4px)}
    .lightbox.open{display:flex}
    .lightbox-inner{max-width:min(92vw,1100px);max-height:88vh;border-radius:20px;overflow:hidden;border:1px solid var(--line);background:#fff;box-shadow:0 30px 60px rgba(50,30,90,.25)}
    .lightbox img{display:block;max-width:100%;max-height:calc(88vh - 58px);object-fit:contain;background:#000}
    .lightbox-bar{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:12px 14px;border-top:1px solid var(--line);font-size:14px;color:#5a5766;background:#fff}
    .x{cursor:pointer;padding:8px 14px;border:1px solid var(--line);border-radius:999px;background:#fff;color:#3a3350;font-weight:700}

    /* VIP gate */
    .gate{display:grid;place-items:center;gap:14px;text-align:center;padding:30px;border:1px dashed #eddcff;border-radius:18px;background:#fff}
    .gate input{max-width:260px;text-align:center}

    /* Preloader */
    #pre{position:fixed;inset:0;background:linear-gradient(180deg,#fff8fe,#fff);display:flex;align-items:center;justify-content:center;z-index:100;transition:opacity .35s ease, visibility .35s ease}
    #pre.hide{opacity:0;visibility:hidden}
    .spin{position:relative;width:90px;height:90px;border-radius:50%;border:8px solid #ffe0f0;border-top-color:#ff5fa2;animation:rot 1.1s linear infinite;box-shadow:0 10px 26px rgba(255,95,162,.22)}
    .spin:after{content:"üíñ";position:absolute;inset:0;display:grid;place-items:center;font-size:28px}
    @keyframes rot{to{transform:rotate(360deg)}}

    /* Responsive */
    @media (max-width:1080px){.grid{grid-template-columns:repeat(3,1fr)}}
    @media (max-width:900px){.hero{grid-template-columns:1fr}}
    @media (max-width:720px){.grid{grid-template-columns:repeat(2,1fr)} .row,.row3{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <!-- Preloader -->
  <div id="pre" aria-hidden="true"><div class="spin" aria-label="Chargement"></div></div>

  <header>
    <div class="wrap nav">
      <div class="brand">
        <span class="logo" aria-hidden="true"></span>
        <span>M√©nage Piquant</span>
        <span class="badge">Sans contact, √©l√©gant et mignon</span>
      </div>
      <nav class="links">
        <a href="#offre" class="badge">Offre</a>
        <a href="#books" class="badge">Books</a>
        <a href="#rdv" class="badge">Rendez-vous</a>
        <a href="#faq" class="badge">FAQ</a>
        <a href="#contact" class="btn small">Contact</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <!-- HERO -->
    <section class="hero" id="offre">
      <div>
        <h1>Sexy, doux, et impeccablement propre</h1>
        <p>Un service de m√©nage <strong>sexy et sans contact</strong>, tenues suggestives, attitude respectueuse, une touche cute qui rend l‚Äôutile agr√©able. Vous profitez du moment visuel, votre espace respire.</p>
        <div class="chips">
          <span class="chip">Ambiance l√©g√®re</span>
          <span class="chip">100% sans contact</span>
          <span class="chip">Discr√©tion totale</span>
          <span class="chip">Book Woman, Book Male</span>
        </div>
        <div class="cta">
          <a href="#books" class="btn">Voir les books</a>
          <a href="#rdv" class="btn ghost">Prendre rendez-vous</a>
        </div>
        <p class="note">Tarifs en priv√©. Images suggestives, jamais explicites, pour personnes s√©rieuses.</p>
      </div>
      <div class="card">
        <h2>Ce que vous obtenez</h2>
        <ul>
          <li>M√©nage complet ou cibl√© selon vos priorit√©s</li>
          <li>Prestation visuelle et respectueuse, sans contact</li>
          <li>Discr√©tion, ponctualit√©, √©l√©gance</li>
          <li>Ambiance au choix, musique douce, √©clairage tamis√©, silence</li>
        </ul>
        <p class="note">Astuce, pr√©parez une courte liste des zones prioritaires pour optimiser le temps sur place.</p>
      </div>
    </section>

    <!-- BOOKS + VIP GATE -->
    <section id="books" class="card">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
        <h2 style="margin:0">Books priv√©s</h2>
        <div class="switcher" role="tablist" aria-label="Choix du book">
          <button class="pill active" data-target="woman" role="tab" aria-selected="true">Book Woman</button>
          <button class="pill" data-target="male" role="tab" aria-selected="false">Book Male</button>
          <button class="pill" data-target="both" role="tab" aria-selected="false">Voir les deux</button>
        </div>
      </div>
      <p class="note" style="margin-top:6px">Images suggestives, non explicites. Le book se renouvelle al√©atoirement √† chaque visite.</p>

      <!-- VIP gate -->
      <div id="vipGate" class="gate" style="margin-top:14px">
        <h3>Acc√®s VIP requis</h3>
        <p class="note">Entrez le mot de passe pour d√©verrouiller les books priv√©s.</p>
        <input id="vipInput" type="password" placeholder="Mot de passe VIP" />
        <div class="cta">
          <button id="vipBtn" class="btn">D√©verrouiller</button>
          <button id="vipHint" class="btn ghost" type="button">Indice</button>
        </div>
        <p id="vipMsg" class="note" role="status"></p>
      </div>

      <!-- WOMAN -->
      <div id="gallery-woman" class="grid" style="margin-top:16px;display:none"></div>
      <!-- MALE -->
      <div id="gallery-male" class="grid" style="margin-top:16px;display:none"></div>
    </section>

    <!-- RDV -->
    <section class="card" id="rdv" style="margin-top:18px">
      <h2>Prise de rendez-vous</h2>
      <p>Choisissez vos pr√©f√©rences et envoyez une demande. Confirmation en priv√© avec toutes les infos utiles.</p>

      <form id="rdvForm" novalidate>
        <div class="row">
          <div>
            <label for="prenom">Votre pr√©nom</label>
            <input id="prenom" name="prenom" type="text" placeholder="Alex" required />
          </div>
          <div>
            <label for="contactMethod">Pr√©f√©rence de contact</label>
            <select id="contactMethod" name="contactMethod" required>
              <option value="" disabled selected>Choisir‚Ä¶</option>
              <option value="SMS">SMS</option>
              <option value="Appel">Appel</option>
              <option value="Courriel">Courriel</option>
            </select>
          </div>
        </div>

        <div id="contactFields" class="row" style="margin-top:8px">
          <div>
            <label for="phone">T√©l√©phone, si SMS ou Appel</label>
            <input id="phone" name="phone" type="tel" placeholder="+1 514‚Ä¶" />
          </div>
          <div>
            <label for="email">Courriel, si Courriel</label>
            <input id="email" name="email" type="email" placeholder="vous@exemple.com" />
          </div>
        </div>

        <div class="row3" style="margin-top:8px">
          <div>
            <label for="date">Date souhait√©e</label>
            <input id="date" name="date" type="date" required />
          </div>
          <div>
            <label for="heure">Heure d‚Äôarriv√©e</label>
            <input id="heure" name="heure" type="time" required />
          </div>
          <div>
            <label for="duree">Dur√©e</label>
            <select id="duree" name="duree" required>
              <option value="" disabled selected>Choisir‚Ä¶</option>
              <option>1 h</option>
              <option>1 h 30</option>
              <option>2 h</option>
              <option>3 h</option>
            </select>
          </div>
        </div>

        <div class="row" style="margin-top:8px">
          <div>
            <label for="typeService">Type de service</label>
            <select id="typeService" name="typeService" required>
              <option value="" disabled selected>Choisir‚Ä¶</option>
              <option value="Classique">Classique, r√©gulier</option>
              <option value="Express">Express, zones cibl√©es</option>
              <option value="Grand m√©nage">Grand m√©nage, en profondeur</option>
            </select>
          </div>
          <div>
            <label for="tenue">Tenue, suggestive et chic</label>
            <select id="tenue" name="tenue" required>
              <option value="" disabled selected>Choisir‚Ä¶</option>
              <option>Niveau l√©ger</option>
              <option>Niveau moyen</option>
              <option>Niveau audacieux, toujours chic</option>
            </select>
          </div>
        </div>

        <div class="row" style="margin-top:8px">
          <div>
            <label for="ambiance">Ambiance</label>
            <select id="ambiance" name="ambiance">
              <option>Standard</option>
              <option>Musique douce</option>
              <option>√âclairage tamis√©</option>
              <option>Silence</option>
            </select>
          </div>
          <div>
            <label for="addOns">Options, facultatif</label>
            <select id="addOns" name="addOns" multiple size="3">
              <option value="Cuisine">Cuisine cibl√©e</option>
              <option value="Salle de bain">Salle de bain cibl√©e</option>
              <option value="Vitres">Vitres, miroirs</option>
            </select>
            <p class="note">Maintenez Ctrl, ou ‚åò, pour plusieurs choix.</p>
          </div>
        </div>

        <div class="row" style="margin-top:8px">
          <div>
            <label for="adresse">Adresse, quartier</label>
            <input id="adresse" name="adresse" type="text" placeholder="Plateau, Montr√©al‚Ä¶" required />
          </div>
          <div>
            <label for="instructions">Instructions ou priorit√©s</label>
            <input id="instructions" name="instructions" type="text" placeholder="Pi√®ces prioritaires, particularit√©s‚Ä¶" />
          </div>
        </div>

        <div style="display:flex;gap:10px;align-items:center;margin-top:8px">
          <input id="okSansContact" type="checkbox" required />
          <label for="okSansContact">Je confirme que la prestation est <strong>strictement sans contact</strong>.</label>
        </div>

        <div class="cta" style="margin-top:12px">
          <button class="btn" type="submit">Envoyer la demande</button>
          <button class="btn ghost" type="button" id="btnIcs" disabled>Ajouter au calendrier, .ics</button>
          <button class="btn ghost" type="button" id="btnTxt" disabled>T√©l√©charger le r√©sum√©, .txt</button>
        </div>

        <div id="rdvStatus" class="card state" style="margin-top:12px;display:none">
          <h3>R√©sum√© de votre demande</h3>
          <div id="rdvSummary" class="note"></div>
        </div>
      </form>
    </section>

    <!-- ZONE -->
    <section class="card" id="zone" style="margin-top:18px">
      <h2>Zone desservie</h2>
      <p><strong>Montr√©al et environs</strong>, d√©placements possibles selon disponibilit√©s, indiquez votre quartier.</p>
    </section>

    <!-- FAQ -->
    <section class="card" id="faq" style="margin-top:18px">
      <h2>FAQ et politiques</h2>
      <div class="policy">
        <p><strong>Sans contact</strong>, prestation strictement visuelle, aucune nudit√© explicite. L‚Äô√©l√©gance prime.</p>
        <p><strong>Tarifs</strong>, transmis en priv√© selon dur√©e, type de service, zone.</p>
        <p><strong>R√©servation</strong>, confirmation par message apr√®s le formulaire, demandes incompl√®tes non trait√©es.</p>
        <p><strong>Annulation</strong>, merci d‚Äôaviser 24 h √† l‚Äôavance, frais possibles si tardive.</p>
        <p><strong>Confidentialit√©</strong>, donn√©es utilis√©es uniquement pour organiser le rendez-vous.</p>
        <p><strong>Limites</strong>, droit de refuser toute demande non conforme √† la charte, respect, s√©curit√©, discr√©tion.</p>
      </div>
    </section>

    <!-- CONTACT -->
    <section class="card" id="contact" style="margin-top:18px">
      <h2>Contact</h2>
      <form id="contactForm" novalidate>
        <div class="row">
          <div>
            <label for="nom">Votre pr√©nom</label>
            <input id="nom" name="nom" type="text" placeholder="Alex" required />
          </div>
          <div>
            <label for="ville">Quartier, ville</label>
            <input id="ville" name="ville" type="text" placeholder="Plateau, Montr√©al" required />
          </div>
        </div>
        <div style="margin-top:8px">
          <label for="message">Votre message</label>
          <textarea id="message" name="message" rows="4" placeholder="Disponibilit√©s, pr√©f√©rences, questions‚Ä¶" required></textarea>
        </div>
        <div style="display:flex;gap:10px;align-items:center;margin-top:8px">
          <input id="ok" type="checkbox" required />
          <label for="ok">Je confirme avoir compris que la prestation est <strong>sans contact</strong>.</label>
        </div>
        <div class="cta" style="margin-top:12px">
          <button class="btn" type="submit">Envoyer</button>
        </div>
        <p id="formNote" class="note">R√©ponse en priv√© avec les informations utiles.</p>
      </form>
    </section>

    <section class="center" style="margin:24px 0">
      <p class="note">¬© <span id="year"></span> M√©nage Piquant, Cute VIP. Tous droits r√©serv√©s.</p>
    </section>
  </main>

  <footer>
    <div class="wrap center">
      <p class="note">Charte, √©l√©gance, mignonnerie, respect des limites.</p>
    </div>
  </footer>

  <!-- LIGHTBOX -->
  <div class="lightbox" id="lightbox" aria-modal="true" role="dialog">
    <div class="lightbox-inner">
      <img id="lbImg" alt="aper√ßu book" />
      <div class="lightbox-bar">
        <span id="lbCap">Book</span>
        <button class="x" id="lbClose" aria-label="Fermer">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Caption editor modal -->
  <div class="lightbox" id="editBox" aria-modal="true" role="dialog" style="backdrop-filter:blur(6px)">
    <div class="lightbox-inner" style="max-width:620px">
      <div style="padding:18px">
        <h3 style="margin:0 0 10px">Modifier la l√©gende</h3>
        <input id="editInput" type="text" placeholder="Nouvelle l√©gende" />
        <div class="cta" style="margin-top:12px">
          <button id="editSave" class="btn">Enregistrer</button>
          <button id="editCancel" class="btn ghost">Annuler</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ======= Config rapide =======
    const CONFIG = {
      VIP_PASSWORD: 'vip2025',      // changez ici
      womanCount: 8,
      maleCount: 8,
      womanPool: Array.from({length:12}, (_,i)=>`img/woman${i+1}.jpg`),
      malePool:  Array.from({length:12}, (_,i)=>`img/male${i+1}.jpg`)
    };

    (function(){
      const $ = (s,r=document)=>r.querySelector(s);
      const $$ = (s,r=document)=>Array.from(r.querySelectorAll(s));

      // Preloader hide on content ready
      window.addEventListener('load', ()=>{ setTimeout(()=>$('#pre').classList.add('hide'), 280); });

      // Year
      $('#year').textContent = new Date().getFullYear();

      // Smooth scroll
      $$('a[href^="#"]').forEach(a=>{
        a.addEventListener('click', e=>{
          const id = a.getAttribute('href').slice(1);
          const el = document.getElementById(id);
          if(el){ e.preventDefault(); el.scrollIntoView({behavior:'smooth', block:'start'}); }
        });
      });

      // VIP Gate
      const vipGate = $('#vipGate');
      const vipInput = $('#vipInput');
      const vipBtn = $('#vipBtn');
      const vipMsg = $('#vipMsg');
      const vipHint = $('#vipHint');
      const keyVIP = 'mp_vip_ok';

      function unlockVIP(){
        vipGate.style.display = 'none';
        renderAll();
        setView('woman');
      }
      function checkVIP(){
        if(sessionStorage.getItem(keyVIP)==='1'){ unlockVIP(); }
      }
      vipBtn.addEventListener('click', ()=>{
        const pass = (vipInput.value||'').trim();
        if(!pass){ vipMsg.textContent = 'Entrez un mot de passe'; return; }
        if(pass === CONFIG.VIP_PASSWORD){
          sessionStorage.setItem(keyVIP,'1');
          unlockVIP();
        } else {
          vipMsg.textContent = 'Mot de passe invalide';
        }
      });
      vipHint.addEventListener('click', ()=>{
        vipMsg.textContent = 'Indice, quatre lettres, trois chiffres, commence par v';
      });
      checkVIP();

      // Galleries
      const gw = $('#gallery-woman');
      const gm = $('#gallery-male');
      function sampleUnique(arr, k){
        const copy = arr.slice();
        for(let i=copy.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [copy[i],copy[j]]=[copy[j],copy[i]]; }
        return copy.slice(0, Math.min(k, copy.length));
      }
      function captionKey(src){ return 'mp_cap_' + src; }

      function buildTile(src, baseLabel){
        const d = document.createElement('div');
        d.className = 'tile';
        const savedCap = localStorage.getItem(captionKey(src));
        const label = savedCap || baseLabel;
        d.innerHTML = `
          <img loading="lazy" alt="${label}" src="${src}" onerror="this.style.opacity=0;this.parentElement.style.display='none';" />
          <span class="cap">${label}</span>
          <button type="button" class="edit">√âditer</button>
        `;
        // Lightbox open
        d.querySelector('img').addEventListener('click', ()=>openLightbox(src, label));
        // Edit caption
        d.querySelector('.edit').addEventListener('click', ()=>{
          openEditor(src, label, newCap=>{
            d.querySelector('.cap').textContent = newCap;
          });
        });
        return d;
      }

      function renderGallery(root, pool, count, label){
        root.innerHTML = '';
        sampleUnique(pool, count).forEach((src, idx)=>{
          root.appendChild(buildTile(src, `${label} ${idx+1}`));
        });
      }

      function renderAll(){
        renderGallery(gw, CONFIG.womanPool, CONFIG.womanCount, 'Woman');
        renderGallery(gm, CONFIG.malePool,  CONFIG.maleCount,  'Male');
        gw.style.display = 'grid';
        gm.style.display = 'none';
      }

      // Switcher tabs
      const pills = $$('.pill');
      function setView(mode){
        if(mode==='woman'){ gw.style.display='grid'; gm.style.display='none'; }
        else if(mode==='male'){ gw.style.display='none'; gm.style.display='grid'; }
        else { gw.style.display='grid'; gm.style.display='grid'; }
        pills.forEach(p=>p.classList.toggle('active', p.dataset.target===mode));
        pills.forEach(p=>p.setAttribute('aria-selected', p.dataset.target===mode ? 'true':'false'));
      }
      pills.forEach(p=>p.addEventListener('click', ()=>{
        if(vipGate.style.display !== 'none') return;
        setView(p.dataset.target);
      }));

      // Lightbox
      const lb = $('#lightbox'), lbImg = $('#lbImg'), lbCap = $('#lbCap'), lbClose = $('#lbClose');
      function openLightbox(src, cap){ lbImg.src = src; lbCap.textContent = cap; lb.classList.add('open'); }
      lbClose.addEventListener('click', ()=>lb.classList.remove('open'));
      lb.addEventListener('click', e=>{ if(e.target===lb) lb.classList.remove('open'); });
      document.addEventListener('keydown', e=>{ if(e.key==='Escape') lb.classList.remove('open'); });

      // Caption editor modal
      const eb = $('#editBox'); const editInput = $('#editInput'); const editSave = $('#editSave'); const editCancel = $('#editCancel');
      let editCtx = null;
      function openEditor(src, current, onSave){
        editCtx = { src, onSave };
        editInput.value = current;
        eb.classList.add('open');
        setTimeout(()=>editInput.focus(), 50);
      }
      function closeEditor(){ eb.classList.remove('open'); editCtx = null; }
      editCancel.addEventListener('click', closeEditor);
      eb.addEventListener('click', e=>{ if(e.target===eb) closeEditor(); });
      document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeEditor(); });
      editSave.addEventListener('click', ()=>{
        const val = (editInput.value||'').trim() || 'Sans titre';
        if(editCtx){
          localStorage.setItem(captionKey(editCtx.src), val);
          editCtx.onSave && editCtx.onSave(val);
        }
        closeEditor();
      });

      // Contact form
      const contactForm = $('#contactForm'); const contactNote = $('#formNote');
      contactForm.addEventListener('submit', e=>{
        e.preventDefault();
        const d = new FormData(contactForm); const ok = $('#ok').checked;
        const valid = ['nom','ville','message'].every(k => (d.get(k)||'').trim().length>1) && ok;
        if(!valid){ contactNote.textContent = 'Merci de compl√©ter tous les champs et de confirmer le sans contact.'; contactForm.classList.add('state','err'); return; }
        const payload = { nom:d.get('nom').trim(), ville:d.get('ville').trim(), message:d.get('message').trim(), sansContact:ok, date:new Date().toISOString() };
        contactNote.textContent = 'Merci, message pr√™t, r√©ponse en priv√©, d√©tail dans la console.'; contactForm.classList.remove('err'); contactForm.classList.add('state','ok');
        console.log('CONTACT | M√©nage Piquant:', payload);
        const reply = `Bonjour ${payload.nom}, merci pour votre message, je me d√©place √† ${payload.ville}, la prestation est strictement sans contact, je reviens vers vous avec les disponibilit√©s et les d√©tails.`;
        navigator.clipboard && navigator.clipboard.writeText(reply).catch(()=>{});
        contactForm.reset();
      });

      // RDV form
      const rdvForm = $('#rdvForm'); const rdvStatus = $('#rdvStatus'); const rdvSummary = $('#rdvSummary');
      const btnIcs = $('#btnIcs'); const btnTxt = $('#btnTxt');
      const dateInput = $('#date'); const today = new Date(); today.setHours(0,0,0,0);
      const pad = n=>String(n).padStart(2,'0'); dateInput.min = `${today.getFullYear()}-${pad(today.getMonth()+1)}-${pad(today.getDate())}`;
      const contactMethod = $('#contactMethod'); const phone=$('#phone'); const email=$('#email');
      function toggleContactFields(){
        const m = contactMethod.value;
        if(m==='SMS' || m==='Appel'){ phone.required = true; email.required = false; }
        else if(m==='Courriel'){ email.required = true; phone.required = false; }
        else { phone.required = false; email.required = false; }
      }
      contactMethod.addEventListener('change', toggleContactFields);
      let lastRdv = null;

      rdvForm.addEventListener('submit', e=>{
        e.preventDefault();
        const data = new FormData(rdvForm);
        const need = ['prenom','contactMethod','date','heure','duree','typeService','tenue','adresse'];
        const missing = need.filter(k => !(data.get(k) && String(data.get(k)).trim().length));
        const okSans = $('#okSansContact').checked;
        toggleContactFields();
        if(contactMethod.value==='SMS' || contactMethod.value==='Appel'){ if(!(phone.value && phone.value.trim().length>6)) missing.push('phone'); }
        else if(contactMethod.value==='Courriel'){ if(!(email.value && email.value.includes('@'))) missing.push('email'); }

        if(missing.length || !okSans){
          rdvStatus.style.display = 'block'; rdvStatus.className = 'card state err';
          rdvSummary.innerHTML = 'Compl√©tez tous les champs et confirmez le <strong>sans contact</strong>.';
          btnIcs.disabled = true; btnTxt.disabled = true; return;
        }
        const getMulti = (fd,n)=>[].concat(fd.getAll(n)||[]).filter(Boolean);
        const entry = {
          prenom:data.get('prenom').trim(), contactMethod:data.get('contactMethod'),
          phone:phone.value.trim(), email:email.value.trim(),
          date:data.get('date'), heure:data.get('heure'), duree:data.get('duree'),
          typeService:data.get('typeService'), tenue:data.get('tenue'),
          ambiance:data.get('ambiance'), addOns:getMulti(data,'addOns'),
          adresse:data.get('adresse').trim(), instructions:(data.get('instructions')||'').trim(),
          sansContact:true, createdAt:new Date().toISOString()
        };
        const parts = [
          `<strong>${entry.prenom}</strong>, voici votre demande :`,
          `‚Ä¢ Rendez-vous, <strong>${formatDateFr(entry.date)}</strong> √† <strong>${entry.heure}</strong>`,
          `‚Ä¢ Dur√©e, <strong>${entry.duree}</strong> ‚Ä¢ Service, <strong>${entry.typeService}</strong>`,
          `‚Ä¢ Tenue, <strong>${entry.tenue}</strong> ‚Ä¢ Ambiance, <strong>${entry.ambiance}</strong>`,
          entry.addOns.length ? `‚Ä¢ Options, ${entry.addOns.join(', ')}` : null,
          `‚Ä¢ Adresse, ${entry.adresse}`,
          entry.instructions ? `‚Ä¢ Notes, ${entry.instructions}` : null,
          `‚Ä¢ Contact, ${entry.contactMethod} ${entry.phone?(' , '+entry.phone):''} ${entry.email?(' , '+entry.email):''}`,
          `‚Ä¢ Rappel, prestation strictement sans contact.`
        ].filter(Boolean);
        rdvStatus.style.display = 'block'; rdvStatus.className = 'card state ok';
        rdvSummary.innerHTML = parts.map(p=>`<p>${p}</p>`).join('');
        lastRdv = entry; btnIcs.disabled = false; btnTxt.disabled = false;
        console.log('RDV | M√©nage Piquant:', entry);
        const ack = `Bonjour ${entry.prenom}, merci pour votre demande du ${formatDateFr(entry.date)} √† ${entry.heure}, je vous recontacte en priv√© pour confirmer l'horaire et les d√©tails, rappel, prestation strictement sans contact.`;
        navigator.clipboard && navigator.clipboard.writeText(ack).catch(()=>{});
      });

      $('#btnTxt').addEventListener('click', ()=>{
        if(!lastRdv) return;
        const text = buildTxt(lastRdv);
        downloadBlob(new Blob([text], {type:'text/plain;charset=utf-8'}), `menage-piquant-rdv-${lastRdv.date}.txt`);
      });
      $('#btnIcs').addEventListener('click', ()=>{
        if(!lastRdv) return;
        const ics = buildICS(lastRdv);
        downloadBlob(new Blob([ics], {type:'text/calendar;charset=utf-8'}), `menage-piquant-${lastRdv.date}.ics`);
      });

      // Utils
      function formatDateFr(yyyy_mm_dd){
        const [y,m,d] = yyyy_mm_dd.split('-').map(Number);
        const dt = new Date(y, m-1, d);
        return dt.toLocaleDateString('fr-CA', {weekday:'long', day:'2-digit', month:'long', year:'numeric'});
      }
      function buildTxt(e){
        return [
          'M√©nage Piquant, Demande de rendez-vous',
          '---------------------------------------',
          `Nom, ${e.prenom}`,
          `Date, ${formatDateFr(e.date)}  Heure, ${e.heure}`,
          `Dur√©e, ${e.duree}`,
          `Service, ${e.typeService}`,
          `Tenue, ${e.tenue}`,
          `Ambiance, ${e.ambiance}`,
          `Options, ${e.addOns.length?e.addOns.join(', '):'Aucune'}`,
          `Adresse, ${e.adresse}`,
          `Notes, ${e.instructions || '‚Äî'}`,
          `Contact, ${e.contactMethod} ${e.phone?(' | '+e.phone):''} ${e.email?(' | '+e.email):''}`,
          `Sans contact, Oui`,
          `Cr√©√© le, ${new Date().toLocaleString('fr-CA')}`
        ].join('\n');
      }
      function toUtcStamp(dateStr, timeStr){
        const [h,m] = timeStr.split(':').map(Number);
        const [Y,M,D] = dateStr.split('-').map(Number);
        const start = new Date(Y,(M-1),D,h,m,0);
        const yyyy = start.getUTCFullYear();
        const mm = String(start.getUTCMonth()+1).padStart(2,'0');
        const dd = String(start.getUTCDate()).padStart(2,'0');
        const HH = String(start.getUTCHours()).padStart(2,'0');
        const MM = String(start.getUTCMinutes()).padStart(2,'0');
        return `${yyyy}${mm}${dd}T${HH}${MM}00Z`;
      }
      function parseDuration(d){
        const m = d.match(/(\d+)\s*h(?:\s*(\d+))?/);
        if(!m) return 60;
        const h = parseInt(m[1],10); const min = parseInt(m[2]||'0',10);
        return (h*60)+min;
      }
      function addMinutesTo(timeStr, mins){
        const [H,M] = timeStr.split(':').map(Number);
        const t = new Date(); t.setHours(H, M+mins, 0, 0);
        return String(t.getHours()).padStart(2,'0')+':'+String(t.getMinutes()).padStart(2,'0');
      }
      function buildICS(e){
        const durationMin = parseDuration(e.duree);
        const endTime = addMinutesTo(e.heure, durationMin);
        const dtStart = toUtcStamp(e.date, e.heure);
        const dtEnd = toUtcStamp(e.date, endTime);
        const uid = `mp-${e.date}-${e.heure.replace(':','')}-${Math.random().toString(36).slice(2,8)}@menagepiquant`;
        const now = toUtcStamp(new Date().toISOString().slice(0,10), new Date().toTimeString().slice(0,5));
        const desc = [
          'M√©nage Piquant, Rendez-vous',
          `Service, ${e.typeService}`,
          `Tenue, ${e.tenue}`,
          `Ambiance, ${e.ambiance}`,
          `Options, ${e.addOns.length?e.addOns.join(', '):'Aucune'}`,
          `Sans contact, Oui`,
          `Notes, ${e.instructions || '‚Äî'}`
        ].join('\\n');

        return [
          'BEGIN:VCALENDAR',
          'VERSION:2.0',
          'PRODID:-//M√©nage Piquant//RDV 2025//FR',
          'CALSCALE:GREGORIAN',
          'METHOD:PUBLISH',
          'BEGIN:VEVENT',
          `UID:${uid}`,
          `DTSTAMP:${now}`,
          `DTSTART:${dtStart}`,
          `DTEND:${dtEnd}`,
          `SUMMARY:M√©nage Piquant, ${e.typeService}`,
          `LOCATION:${escapeIcs(e.adresse)}`,
          `DESCRIPTION:${escapeIcs(desc)}`,
          'END:VEVENT',
          'END:VCALENDAR'
        ].join('\r\n');
      }
      function escapeIcs(s){ return String(s||'').replace(/[\\,;\n]/g, m=>({ '\\\\':'\\\\',';':'\\;','\\,':'\\,','\\n':'\\n' }[m]||m)); }
      function downloadBlob(blob, filename){
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = filename; a.click();
        setTimeout(()=>URL.revokeObjectURL(url), 1200);
      }
    })();
  </script>
</body>
</html>
